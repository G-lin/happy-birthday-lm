import{t as e,c as t,w as a}from"./index.dab47157.js";import{L as r,$ as i}from"./vant.d7724c5c.js";import{a as o,l as n,T as s,b as l}from"./function.bbd77873.js";import{k as d,j as u,s as c,Q as g,l as f,h as p,n as m,f as h,q as x,z as T,r as v,o as y,c as S,M as b,R as N,S as j}from"./vendor.0f092f4c.js";import{d as L,u as $,b as w,a as D,p as k}from"./on-popup-reopen.0949650a.js";import{u as V,i as C,g as H}from"./List.e58eb8bb.js";import{u as B}from"./index.e96c26ce.js";import"./interceptor.819961a5.js";import"./use-route.e59723ab.js";import"./index.435cda4d.js";import"./index.46714bee.js";import"./index.6c3adf38.js";var[R,z,U]=t("list"),M=a(d({name:R,props:{error:Boolean,loading:Boolean,finished:Boolean,errorText:String,loadingText:String,finishedText:String,immediateCheck:e,offset:{type:[Number,String],default:300},direction:{type:String,default:"down"}},emits:["load","update:error","update:loading"],setup(e,{emit:t,slots:a}){var i=u(!1),o=u(),n=u(),s=V(),l=L(o),d=()=>{m((()=>{if(!(i.value||e.finished||e.error||!1===(null==s?void 0:s.value))){var{offset:a,direction:r}=e,d=B(l);if(d.height&&!C(o)){var u=B(n);("up"===r?d.top-u.top<=a:u.bottom-d.bottom<=a)&&(i.value=!0,t("update:loading",!0),t("load"))}}}))},h=()=>{if(e.finished){var t=a.finished?a.finished():e.finishedText;if(t)return p("div",{class:z("finished-text")},[t])}},x=()=>{t("update:error",!1),d()},T=()=>{if(e.error){var t=a.error?a.error():e.errorText;if(t)return p("div",{class:z("error-text"),onClick:x},[t])}},v=()=>{if(i.value&&!e.finished)return p("div",{class:z("loading")},[a.loading?a.loading():p(r,{class:z("loading-icon")},{default:()=>[e.loadingText||U("loading")]})])};return c([()=>e.loading,()=>e.finished,()=>e.error],d),g((()=>{i.value=e.loading})),f((()=>{e.immediateCheck&&d()})),$({check:d}),w("scroll",d,{target:l}),()=>{var t=null==a.default?void 0:a.default(),r=p("div",{ref:n,class:z("placeholder")},null);return p("div",{ref:o,role:"feed",class:z(),"aria-busy":i.value},["down"===e.direction?t:r,v(),h(),T(),"up"===e.direction?t:r])}}})),[_,O,q]=t("pull-refresh"),A=["pulling","loosing","success"],J=a(d({name:_,props:{disabled:Boolean,successText:String,pullingText:String,loosingText:String,loadingText:String,pullDistance:[Number,String],modelValue:{type:Boolean,default:!1},successDuration:{type:[Number,String],default:500},animationDuration:{type:[Number,String],default:300},headHeight:{type:[Number,String],default:50}},emits:["refresh","update:modelValue"],setup(e,{emit:t,slots:a}){var i,o=u(),n=L(o),s=h({status:"normal",distance:0,duration:0}),l=D(),d=()=>{if(50!==e.headHeight)return{height:e.headHeight+"px"}},g=()=>"loading"!==s.status&&"success"!==s.status&&!e.disabled,f=(t,a)=>{var r=+(e.pullDistance||e.headHeight);s.distance=t,s.status=a?"loading":0===t?"normal":t<r?"pulling":"loosing"},x=()=>{var{status:t}=s;return"normal"===t?"":e[t+"Text"]||q(t)},T=()=>{var{status:e,distance:t}=s;if(a[e])return a[e]({distance:t});var i=[];return A.includes(e)&&i.push(p("div",{class:O("text")},[x()])),"loading"===e&&i.push(p(r,{class:O("loading")},{default:()=>[x()]})),i},v=e=>{(i=0===H(n.value))&&(s.duration=0,l.start(e))},y=e=>{g()&&v(e)},S=t=>{if(g()){i||v(t);var{deltaY:a}=l;l.move(t),i&&a.value>=0&&l.isVertical()&&(k(t),f((r=a.value,o=+(e.pullDistance||e.headHeight),r>o&&(r=r<2*o?o+(r-o)/2:1.5*o+(r-2*o)/4),Math.round(r))))}var r,o},b=()=>{i&&l.deltaY.value&&g()&&(s.duration=+e.animationDuration,"loosing"===s.status?(f(+e.headHeight,!0),t("update:modelValue",!0),m((()=>t("refresh")))):f(0))};return c((()=>e.modelValue),(t=>{s.duration=+e.animationDuration,t?f(+e.headHeight,!0):a.success||e.successText?(s.status="success",setTimeout((()=>{f(0)}),+e.successDuration)):f(0,!1)})),()=>{var e={transitionDuration:s.duration+"ms",transform:s.distance?"translate3d(0,"+s.distance+"px, 0)":""};return p("div",{ref:o,class:O()},[p("div",{class:O("track"),style:e,onTouchstart:y,onTouchmove:S,onTouchend:b,onTouchcancel:b},[p("div",{class:O("head"),style:d()},[T()]),null==a.default?void 0:a.default()])])}}}));const Y={name:"WeiPageList",components:{[J.name]:J,[M.name]:M},props:{url:{type:String},data:{type:Object,default:()=>{}},method:{type:String,default:"get"},contentType:{type:String,default:"application/x-www-form-urlencoded; charset=UTF-8"},timeout:{type:Number,default:2e4},pageSize:{type:Number,default:10},pullingText:{type:String,default:"下拉即可刷新..."},loosingText:{type:String,default:"释放即可刷新..."},successText:{type:String,default:"刷新成功"},successDuration:{type:Number,default:500},animationDuration:{type:Number,default:300},offset:{type:Number,default:100},loadingText:{type:String,default:"加载中..."},finishedText:{type:String,default:""},immediateCheck:{type:Boolean,default:!0},timeShowLoadAnimation:{type:Number,default:222}},mounted(){this.$emit("my-ref",this)},setup(e,{emit:t}){const a=x();let r=h({error:!1,text:"加载失败，请重试"}),d=h({pageNum:1,list:[]}),u=h({loading:!1,onRefresh:()=>{u.loading=!0,g()}}),c=h({loading:!1,finish:!1,load:()=>{c.loading=!0,f()}});const g=()=>{d.pageNum=1,d.list=[],c.finish=!1,f()},f=()=>{let{url:g,method:f,contentType:p,timeout:m,data:h={},pageSize:x,timeShowLoadAnimation:T}=e,v={url:"http://82.156.70.219/muteki/api"+g,method:f,headers:{"Content-Type":p,token:o.getLocationStorage("token")},timeout:m};h.__t=(new Date).getTime(),h.pageNum=d.pageNum,h.pageSize=x,"GET"===f.toUpperCase()?v.params=h:v.data=n.stringify(h,{indices:!1}),c.loading=!0;let y=null,S=setTimeout((()=>{y=s.loading({message:"加载中...",forbidClick:!0})}),T);l(v).then((e=>{clearTimeout(S),null!=y&&y.clear(),u.loading=!1,c.loading=!1;try{let{code:n,msg:s}=e.data;if(401===n){i.errorMsg("登陆过期，自动登录中。。。");let e=setTimeout((()=>{clearTimeout(e),a.replace("login")}),3e3);return}if(200!==n)return i.errorMsg(s),r.errorText=s,void console.warn(`url:${g}:请求出错，详情"${JSON.stringify(e.data)}`);try{let{list:a}=e.data.data;null==a||0>=a.length?c.finish=!0:(d.pageNum++,d.list=d.list.concat(a));try{t("change",d.list)}catch(o){console.error(o)}}catch(o){r.errorText=`返回格式错误，示例:${JSON.stringify({List:[],pageNum:1,pageSize:10})}`,console.warn(`url:${g}:请求出错，详情"${o}`)}}catch(o){r.errorText=`加载失败，请重试。${o}`,console.warn(`url:${g}:请求出错，详情"${o}`)}})).catch((e=>{clearTimeout(S),null!=y&&y.clear(),u.loading=!1,c.loading=!1,r.error=!0,r.errorText=`加载失败，请重试。${e}`,console.warn(`url:${g}:请求出错，详情"${e}`)}))};let p=T((()=>null==d.list||0>=d.list.length?"":"没有更多了"));return{error:r,pull:u,onLoad:c,resetDataRequest:g,finishText:p}}};Y.render=function(e,t,a,r,i,o){const n=v("van-list"),s=v("van-pull-refresh");return y(),S(s,{modelValue:r.pull.loading,"onUpdate:modelValue":t[3]||(t[3]=e=>r.pull.loading=e),"pulling-text":a.pullingText,"loosing-text":a.loosingText,"success-text":a.successText,onRefresh:r.pull.onRefresh},{default:b((()=>[p(n,{loading:r.onLoad.loading,"onUpdate:loading":t[1]||(t[1]=e=>r.onLoad.loading=e),finished:r.onLoad.finish,"finished-text":r.finishText,error:r.error.error,"onUpdate:error":t[2]||(t[2]=e=>r.error.error=e),"error-text":r.error.errorText,offset:a.offset,"loading-text":a.loadingText,onLoad:r.onLoad.load},{default:b((()=>[r.error.error?j("",!0):N(e.$slots,"default",{key:0})])),_:3},8,["loading","finished","finished-text","error","error-text","offset","loading-text","onLoad"])])),_:1},8,["modelValue","pulling-text","loosing-text","success-text","onRefresh"])};export default Y;
