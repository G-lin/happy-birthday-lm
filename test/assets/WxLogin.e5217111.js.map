{"version":3,"file":"WxLogin.e5217111.js","sources":["../../../src/views/login/WxLogin.vue"],"sourcesContent":["<template>\n    <div></div>\n</template>\n\n<script>\n    //引入router\n    import {useRouter, useRoute} from 'vue-router';\n    import {onMounted} from 'vue';\n    import $global from '@/utils/global';\n    import $axios from '@/utils/axios';\n    import $function from '@/utils/function';\n\n    export default {\n        name: \"WxLogin\",\n        setup() {\n            const $router = useRouter();\n\n            /**\n             * 获取页面中的code\n             * @param key\n             */\n            const getCode = () => {\n                let url = window.location.href;\n                if (!url.includes('?')) {\n                    return '';\n                }\n                let startIndex = url.indexOf('?') + 1;\n                let str = url.substr(startIndex);\n                let strArr = str.split('&');\n                let code = '';\n                for (let i = 0; i < strArr.length; i++) {\n                    let arr = strArr[i].split('=');\n                    if ('code' !== arr[0]) {\n                        continue;\n                    }\n                    code = arr[1];\n                }\n                return code;\n            }\n\n            onMounted(() => {\n                //如果是开发环境\n                if ('development' === import.meta.env.MODE) {\n                    $function.setLocationStorage('token', '111');\n                    $router.push('/home');\n                    return;\n                }\n\n                let code = getCode();\n                if ('' === code) {\n                    //如果没有code,请求后台重定向\n                    window.location.href = `${import.meta.env.VITE_APP_URL}${$global.api.getRedirectUri}`;\n                    return;\n                }\n                $axios({\n                    url: $global.api.login,\n                    method: 'post',\n                    data: {\n                        code\n                    },\n                    success(data) {\n                        $function.setLocationStorage('token', data);\n                        let {origin, pathname} = window.location;\n                        /**\n                         * 解决hash路由多余参数问题\n                         * http://xxx.weiziplus.net/wechat/?code=011s4Fkl2GmdB64Gxbol2eh5zF4s4Fky&state=666#/\n                         * ↓↓↓↓↓跳转到↓↓↓↓↓\n                         * http://xxx.weiziplus.net/wechat/#/home\n                         */\n                        window.location.href = `${origin}${pathname}#/home`;\n                    }\n                });\n            });\n\n            return {}\n        }\n    }\n</script>"],"names":["name","[object Object]","code","url","window","location","href","includes","startIndex","indexOf","strArr","substr","split","i","length","arr","getCode","$global","api","login","method","data","setLocationStorage","origin","pathname","getRedirectUri"],"mappings":"mVAYS,SACDA,KAAM,UACNC,sBA0Bc,SAQFC,EA3BQ,UACRC,EAAMC,OAAOC,SAASC,SACrBH,EAAII,SAAS,WACP,OAEPC,EAAaL,EAAIM,QAAQ,KAAO,EAEhCC,EADMP,EAAIQ,OAAOH,GACJI,MAAM,KACnBV,EAAO,WACFW,EAAI,EAAGA,EAAIH,EAAOI,OAAQD,IAAK,KAChCE,EAAML,EAAOG,GAAGD,MAAM,KACtB,SAAWG,EAAI,OAGZA,EAAI,WAERb,GAWIc,GACP,KAAOd,IAKJ,CACHC,IAAKc,EAAQC,IAAIC,MACjBC,OAAQ,OACRC,KAAM,CACFnB,KAAAA,GAEJD,QAAQoB,KACMC,mBAAmB,QAASD,OAClCE,OAACA,WAAQC,GAAYpB,OAAOC,gBAOzBA,SAASC,KAAO,GAAGiB,IAASC,oBAlBhCnB,SAASC,KAAO,kCAAkCW,EAAQC,IAAIO,oBAuBtE"}